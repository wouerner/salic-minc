<div class="col s12 m12 l2">
    <aside id="left-sidebar-nav">
        <ul class="sidebar-nav">
            <li class="detalhes-proposta <?php  echo (!$this->isEditavel) ? 'grey' : 'green'; ?> darken-2 no-padding">
                <div class="row">
                    <div class="col s12 m12 l12">
                        <p class="white-text">
                            <i class="material-icons left tiny"><?php echo (!$this->isEditavel) ? 'lock_outline' : 'lock_open'; ?></i>
                            <b><?php echo $this->layout['titleFull']; ?></b>
                        </p>
                        <p class="white-text">
                            <?php echo isset($this->layout['titleShort']) ? $this->layout['titleShort'] : 'Proposta'; ?>
                            <?php echo isset($this->layout['projeto']) ? $this->layout['projeto'] : $this->proposta['idpreprojeto']; ?>
                        </p>
                        <p class="white-text"><?php echo isset($this->proposta['nomeprojeto']) ? $this->proposta['nomeprojeto'] : ''; ?></p>
                        <?php if( isset($this->layout['prazoAlterarProjeto']) && $this->layout['prazoAlterarProjeto'] > 0 ) : ?>
                            <p class="white-text">
                                <?php $n = round($this->layout['prazoAlterarProjeto']); ?>
                                <i class="material-icons left tiny">query_builder</i>
                                <span id="cronometro"></span>
                            </p>
                        <?php endif; ?>
                    </div>
                </div>
            </li>
            <?php echo $this->partialLoop('/menu/partials/item.phtml', 'proposta', $this->arrMenuProponente); ?>
        </ul>
    </aside>

    <div id="trocarproponente" style="display:none">

        <form id="formtrocaproponente"
              action="<?php echo $this->url(array('module' => 'proposta', 'controller' => 'vincularresponsavel', 'action' => 'trocarproponente')); ?>"
              method="post">
            <?php
            $idVinculoProposta = "";
            if (!empty($this->dadosVinculo[0])) {
                $idVinculoProposta = $this->dadosVinculo[0]->idvinculoproposta;
            }
            ?>
            <input type="hidden" value="<?php echo $idVinculoProposta; ?>" name="idVinculoProposta"/>
            <input type="hidden" value="<?php echo $idPreProjeto; ?>" name="idPreProjeto"/>
            <input type="hidden" value="1" name="mecanismo"/>
            <table class="tabela">
                <tr>
                    <td class="titulo_tabela">Selecione um Proponente ou cadastre um novo.</td>
                </tr>
                <tr>
                    <td>
                        CPF/CNPJ Proponente:&nbsp;
                        <select name="propronente" id="propronente" class="input_simples w240">
                            <?php $idAgente = 0; ?>
                            <?php if ($this->listaProponentes): ?>
                                <?php foreach ($this->listaProponentes as $lp): $lp = array_change_key_case($lp); ?>
                                    <?php if ($lp['idagenteproponente'] != $idAgente): ?>
                                        <option
                                            value="<?php echo $lp['idvinculo']; ?>:<?php echo $lp['idagenteproponente']; ?>"><?php echo $lp['nomeproponente']; ?></option>
                                    <?php endif; ?>

                                    <?php $idAgente = $lp['idagenteproponente']; ?>
                                <?php endforeach; ?>
                            <?php endif; ?>
                        </select>&nbsp;<span id="msgValidaProponente"></span>&nbsp;&nbsp;&nbsp;
                    </td>
                </tr>
            </table>
        </form>
    </div>
</div>
<script type="text/javascript">
    function layout_fluido() {
        var janela = $(window).width();

        $("#navglobal").css("width", "100%");
        $("#conteudo").css("width", "100%");
        $("#titulo").css("width", "100%");
        $("#rodapeConteudo").css("width", "100%");
        $("#rodape").css("width", "100%");
        $("div#rodapeConteudo").attr("id", "rodapeConteudo_com_menu");
    }

    $(document).ready(function () {

        $('.planilha').click(function () {
            $(this).next().toggle('fast');
        });

        $('#excluirproposta').click(function () {
            JSExcluirProposta();
        });

        $('#enviarproposta').click(function () {
            JSEnviarProposta();
        });

    });

    function JSExcluirProposta() {

        var text = 'Deseja realmente excluir sua proposta?';

        $('<div id="modalExcluirProposta"></div>').appendTo($("#left-sidebar-nav")).html(text)

        $("#modalExcluirProposta").dialog("destroy");
        $("#modalExcluirProposta").dialog
        ({
            width: 450,
            height: 200,
            EscClose: false,
            modal: true
            , buttons: {
                'Cancelar': function () {
                    $(this).dialog('close');
                },
                'OK': function () {
                    window.location = "<?php echo $this->baseUrl(); ?>/proposta/manterpropostaedital/exluirproposta/?idPreProjeto=<?php echo $idPreProjeto; ?>";
                    $(this).dialog('close');
                }
            }
        });
        return false;
    }

    function trocarproponente() {

        $('<div id="trocarproponente"></div>').appendTo($("#left-sidebar-nav")).html(text)

        $("#trocarproponente").dialog("destroy");
        $("#trocarproponente").dialog
        ({
            width: 600,
            height: 250,
            EscClose: false,
            modal: true,
            title: 'Trocar Proponente'
            , buttons: {
                'Cancelar': function () {
                    $(this).dialog('close'); // fecha a modal
                },
                'Novo Proponente': function () {
                    window.location = "<?php echo $this->url(array('module' => 'proposta', 'controller' => 'vincularresponsavel', 'action' => 'index')); ?>";
                },
                'Trocar Proponente': function () {
                    $("#formtrocaproponente").submit();

                }
            }
        });

        return false;
    }

    function JSPrazoDeAlterarExpirado() {
        var text = 'O prazo para alterar o projeto expirou!';

        $('<div id="modalEnviarProposta"></div>').appendTo($("#left-sidebar-nav")).html(text)

        $("#modalEnviarProposta").dialog("destroy");
        $("#modalEnviarProposta").dialog
        ({
            width: 450,
            height: 200,
            position: 'center',
            EscClose: false,
            modal: true,
            buttons: {
                'OK': function () {
                    window.location = "<?php echo $this->baseUrl(); ?>/proposta/manterorcamento/produtoscadastrados/idPreProjeto/<?php echo $idPreProjeto; ?>";
                    $(this).dialog('close');
                }
            }
        });

        return false;
    }

    <?php if( isset($this->layout['prazoAlterarProjeto'])) : ?>
    var segundos = new Number();
    var segundos = <?php print $this->layout['prazoAlterarProjeto']; ?>;
    <?php endif; ?>

    function contagemregressiva()
    {

        if( ( segundos - 1 ) >= 0 )
        {
            segundos = segundos - 1;
            if( segundos > 86400 )
            {
                dias = Math.round( segundos / 86400 );
                cronometro.innerText = dias + ' dias para alterar';
            }
            else if( segundos > 3600 )
            {
                horas = Math.round( segundos / 3600 );
                cronometro.innerText = horas + ' horas para alterar';
            }
            else if( segundos > 60 )
            {
                minutos = Math.round( segundos / 60 );
                cronometro.innerText = minutos + ' minutos para alterar';
            }
            else if( segundos > 0 )
            {
                cronometro.innerText = segundos + ' segundos para alterar';
            }
            else
            {
                JSPrazoDeAlterarExpirado();
                JSBloquearAlteracaoFormulario();
                cronometro.innerText = 'Alterar projeto encerrado';
            }
            setTimeout( 'contagemregressiva()', 1000 );
        }
    }
    <?php if( isset($this->layout['prazoAlterarProjeto'])) : ?>
    contagemregressiva();
    <?php endif; ?>
</script>
