<div class="container-fluid">
    <div class="row">
        <?php
        $buscarFornecedorHref = $this->url(array('controller' => 'comprovarexecucaofinanceira', 'action' => 'buscarfornecedor')) . '?idusuario=' . $this->idusuario;

        $urlArray = array(
            'controller' => 'comprovarexecucaofinanceira',
            'action' => 'pagamento',
            'idusuario' => $this->idusuario,
            'idpronac' => $this->idpronac,
        );
        $voltarHref = $this->url(\array_merge($urlArray, array('action' => 'pagamento')));
        $carregarSelectHref = $this->url(\array_merge($urlArray, array('action' => 'carregaselectajax')));


        echo '<script type="text/javascript" language="javascript" src="' . $this->baseUrl() . '/public/js/jquery/jquery.formatCurrency-1.4.0.min.js"></script>';
        echo '<script type="text/javascript" language="javascript" src="' . $this->baseUrl() . '/public/js/jquery/jquery.formatCurrency.pt-BR.js"></script>';
        echo '<script type="text/javascript" language="javascript">var planilhaItem = ' . $this->itemPlanilhaAprovacao->idPlanilhaAprovacao . '</script>';

        if (!$this->vrSituacao) {
            echo '<div class="col s2">';
            echo $this->partial('comprovarexecucaofinanceira/inc/menu.inc.php', $this);
            echo '</div>';
        }

        # tratamento para liberar edicao de comprovante
        $formUrl = $this->url(array_merge(
            $urlArray,
            array('action' => 'cadastrarcomprovacaopagamento', 'itemId' => $this->itemPlanilhaAprovacao->idPlanilhaAprovacao)
        ));
        if ($this->idComprovantePagamento) {
            $formUrl = $this->url(array_merge(
                $urlArray,
                array('action' => 'atualizarcomprovacaopagamento', 'itemId' => $this->itemPlanilhaAprovacao->idPlanilhaAprovacao)
            ));
        }
        ?>

        <div id="divPerguntaFornecedor" class="sumir"></div>
        <div id="divExcluirComprovantes" class="sumir"></div>
        <div id="msgAlerta" class="sumir"></div>

        <div class="col s10">
            <?php if (!$this->vrSituacao) : ?>
                <div class="row" id="breadcrumb">
                    <div class="col s12">
                        <ul>
                            <li class="first"><a
                                    href="<?php echo $this->url(array('controller' => 'principalproponente', 'action' => ''), null, true); ?>"
                                    title="Ir para p&aacute;gina inicial" onclick="carregandoModal();">In&iacute;cio</a>
                            </li>
                            <li class="second"><a
                                    href="<?php echo $this->url(array('controller' => 'consultardadosprojeto', 'action' => '')) . '?idPronac=' . Seguranca::encrypt($this->idpronac); ?>"
                                    title="Ir para In&iacute;cio">Consultar dados do Projeto</a></li>
                            <li>Comprovar Execu&ccedil;&atilde;o Financeira</li>
                            <li><a href="<?php echo $pagamentoHref; ?>" title="Pagamento" onclick="carregandoModal();">Pagamento</a>
                            </li>
                            <li class="last">Comprovar Pagamento</li>
                        </ul>
                    </div>
                </div>
            <?php endif; ?>

            <div class="row">
                <div class="col s8">
                    <h5>
                        Comprovar Pagamento
                        <?php if ($this->idComprovantePagamento): ?>
                            - editando item
                        <?php else: ?> 
                            - cadastrar item
                        <?php endif; ?>
                    </h5>
                </div>
                <div class="col s4 align-right">
                    <?php if (!$this->vrSituacao || !$this->pagCompRecusado) : ?>
                        <span class="voltar"><a class="btn" href="<?php echo $voltarHref; ?>"
                                                title="Ir para p&aacute;gina anterior">
                    <i class="material-icons left">arrow_back</i>Voltar</a>
                </span>
                    <?php endif; ?>
                </div>
            </div>
            <div class="row">
                <div class="col s12">
                    <div id="incluircomprovacaoAjax">
                        <form
                            action="<?php echo $formUrl; ?>"
                            id="frComprovarPagamento"
                            name="frComprovarPagamento"
                            enctype="multipart/form-data"
                            method="post"
                            class="browser-default"
                        >
                            <input type='hidden' name='idComprovantePagamento' id='idComprovantePagamento'
                                   value='<?php echo $this->idComprovantePagamento; ?>'/>
                            <input type='hidden' name='idpronac' id='idpronac' value='<?php echo $this->idpronac; ?>'/>

                            <?php if ($this->idComprovantePagamento): ?>
                                <input type='hidden' name='paginaRedirecionar' id='paginaRedirecionar'
                                       value='comprovacaopagamento'/>
                            <?php endif; ?>
                            <input type='hidden' name='valorAprovado' id='valorAprovado'
                                   value='<?php echo $this->itemPlanilhaAprovacao->valorAprovado; ?>'/>
                            <input type='hidden' name='totalComprovado' id='totalComprovado'
                                   value='<?php echo $this->itemPlanilhaAprovacao->vlComprovado ? $this->itemPlanilhaAprovacao->vlComprovado : '0'; ?>'/>

                            <table id="tabelaItem" class="bordered">
                                <caption>Vincular Item de Custo</caption>
                                <thead>
                                    <tr>
                                        <th class="">Produto</th>
                                        <th class="">Etapa</th>
                                        <th class="">Itens de Custo</th>
                                        <th class="" id="campoValorAprovado">Valor Aprovado</th>
                                        <th class="" id="campoValorComprovado">Total Comprovado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><?php echo $this->produto->Sintese; ?></td>
                                        <td><?php echo $this->etapa->Descricao; ?></td>
                                        <td><?php echo $this->item->Descricao; ?></td>
                                        <td><?php echo $this->currency($this->itemPlanilhaAprovacao->valorAprovado); ?></td>
                                        <td><?php echo $this->currency($this->itemPlanilhaAprovacao->vlComprovado ? $this->itemPlanilhaAprovacao->vlComprovado : '0'); ?></td>
                                    </tr>
                                </tbody>
                            </table>

                                <div id="tabelaComprovante">
                                    <fieldset>
                                        <legend>Identifica&ccedil;&atilde;o do Contratado</legend>
                                        <input type="hidden" name="idAgente" id="idAgente" value="<?php echo $this->idAgente; ?>"/>
                                        <div class="row">
                                            <div class="input-field col s4">
                                                <select
                                                    id="pais"
                                                    name="pais"
                                                    class="left-align "
                                                    onchange="toggleTabelaComprovacaoPagamentoInvoice();" >
                                                    <?php foreach ($this->paises as $pais) : ?>
                                                        <option value="<?php echo $pais->Descricao; ?>"
                                                            <?= ($this->paisFornecedor == $pais->Descricao) ? 'selected="selected"' : ''; ?>
                                                            <?= ($this->paisFornecedor == '' && $pais->Descricao == 'Brasil') ? 'selected="selected"' : ''; ?>
                                                        ><?php echo $pais->Descricao; ?>
                                                        </option>
                                                    <?php endforeach; ?>
                                                </select>
                                                <label class="actived" for="pais">Nacionalidade do Fornecedor <span style='color:red'>*</span></label>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class=" col s6">
                                                <p>Tipo do Fornecedor <span style='color:red'>*</span></p>
                                                <p>
                                                    <input
                                                        type="radio"
                                                        id="tpFornecedorCpf"
                                                        name="tpFornecedor"
                                                        class="tpFornecedor"
                                                        value="cpf"
                                                        null="false"
                                                        <?php echo $this->fornecedor && $this->fornecedor->usaCnpj ? '' : 'checked="checked"'; ?>
                                                    />
                                                    <label for="tpFornecedorCpf">CPF</label>
                                                    <input
                                                        type="radio"
                                                        id="tpFornecedorCnpj"
                                                        name="tpFornecedor"
                                                        class="tpFornecedor"
                                                        value="cnpj"
                                                        <?php echo $this->fornecedor && $this->fornecedor->usaCnpj ? 'checked="checked"' : ''; ?>
                                                    />
                                                    <label for="tpFornecedorCnpj">CNPJ</label>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="input-field col s6">
                                                <input
                                                    type="text"
                                                    autocomplete="off"
                                                    name="CNPJCPF"
                                                    id="CNPJCPF"
                                                    idAgente="idAgente"
                                                    idDescricao="Descricao"
                                                    cnpjcpf="true"
                                                    classaux="tpFornecedor"
                                                    null="false"
                                                    value="<?php echo $this->CNPJCPF; ?>"
                                                />
                                                <label for="CNPJCPF">CNPJ/CPF<span style='color:red'>*</span></label>
                                            </div>
                                            <div class="input-field col s6">
                                                <input
                                                    type="text"
                                                    name="Descricao"
                                                    id="Descricao"
                                                    null="false"
                                                    value="<?php echo $this->Descricao; ?>"
                                                    <?php echo $this->CNPJCPF ? 'readonly="readonly"' : ''; ?>
                                                />
                                                <label>Nome/Raz&atilde;o Social<span style='color:red'>*</span></label>
                                            </div>
                                        </div>
                                    </fieldset>

                                    <!-- Identificação Nacional -->
                                    <div id="bodyTabelaComprovante">
                                        <fieldset>
                                            <legend>Dados da Comprova&ccedil;&atilde;o de Pagamento</legend>
                                            <div class="row">
                                                <div class="input-field col s4">
                                                    <select name="tpDocumento" id="tpDocumento">
                                                        <?php
                                                        foreach ($this->tipoDocumentoConteudo as $key => $value) :
                                                            $selected = $this->tpDocumento == $key ? 'selected="selected"' : null;
                                                            echo "<option value='{$key}' {$selected}>{$value}</option>";
                                                        endforeach
                                                        ?>
                                                    </select>
                                                    <label>Comprovante<span style='color:red'>*</span></label>
                                                </div>
                                                <div class="input-field col s4">
                                                    <input type="text" name="nrComprovante" id="nrComprovante"
                                                           maxlength="50" null="false"
                                                           value="<?php echo $this->nrComprovante; ?>"/>
                                                    <label>N&uacute;mero<span style='color:red'>*</span></label>
                                                </div>
                                                <div class="input-field col s4">
                                                    <input type="text" name="nrSerie" id="nrSerie" maxlength="8"
                                                           null="true"
                                                           value="<?php echo $this->nrSerie; ?>"/>
                                                    <label><b id="nmSerieTxt">S&eacute;rie</b></label>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="input-field col s4">
                                                    <input type="text" name="dtEmissao" id="dtEmissao" null="false"
                                                           data="true" value="<?php echo $this->dtEmissao; ?>"/>
                                                    <label>Dt. do Documento<span style='color:red'>*</span></label>
                                                </div>
                                                <div class="input-field col s4">
                                                    <select name="tpFormaDePagamento" id="tpFormaDePagamento"
                                                            style="width: 180px;">
                                                        <?php
                                                        $selected1 = $this->tpFormaDePagamento == 1 ? 'selected="selected"' : null;
                                                        $selected2 = $this->tpFormaDePagamento == 2 ? 'selected="selected"' : null;
                                                        $selected3 = $this->tpFormaDePagamento == 3 ? 'selected="selected"' : null;
                                                        ?>
                                                        <option value="0"> - Selecione -</option>
                                                        <option value="1" <?php echo $selected1; ?>>Cheque</option>
                                                        <option value="2" <?php echo $selected2; ?>>Transfer&ecirc;ncia
                                                            Banc&aacute;ria
                                                        </option>
                                                        <option value="3" <?php echo $selected3; ?>>Saque/Dinheiro
                                                        </option>
                                                    </select>
                                                    <label>Forma de Pagamento<span style='color:red'>*</span></label>
                                                </div>
                                                <div class="input-field col s4">
                                                    <input type="text" name="nrDocumentoDePagamento"
                                                           id="nrDocumentoDePagamento" maxlength="10"
                                                           null="false" sonumero="true"
                                                           value="<?php echo $this->nrDocumentoDePagamento; ?>"/>
                                                    <label for="nrDocumentoDePagamento">N&ordm; Documento Pagamento<span
                                                            style='color:red'>*</span></label>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="input-field col s3">
                                                    <input type="text" name="vlComprovado" size="10" id="vlComprovado"
                                                           value="<?php echo $this->vlComprovacao; ?>"/>
                                                    <label>Valor do Item <span style='color:red'>*</span></label>
                                                </div>
                                                <div class="file-field input-field col s4">
                                                    <!-- input type="file" name="arquivo" id="arquivo" value=""/>
                                                    <label>Anexar comprovante<span style='color:red'>*</span></label -->

                                                    <div class="btn small">
                                                        <input name="arquivo" id="arquivo" type="file">
                                                        <span>Comprovante</span>
                                                    </div>
                                                    <div class="file-path-wrapper">
                                                        <input class="file-path validate" type="text" placeholder="Selecionar arquivo">
                                                    </div>
                                                </div>
                                                <?php if ($this->idComprovantePagamento): ?>
                                                    <input type="hidden" name="arquivo_edit" id="arquivo_edit"
                                                           value="<?php echo $this->idArquivo; ?>"/>
                                                <?php endif; ?>
                                                <a href="<?php echo $this->url(array('controller' => 'upload', 'action' => 'abrir'), '', true); ?>?id=<?php echo $this->idArquivo; ?>"><?php echo $this->nomeArquivo; ?></a>
                                            </div>
                                            <div class="row">
                                                <div class="input-field col s12">
                                                    <textarea class="materialize-textarea" rows="5"
                                                              name="dsJustificativa"
                                                              id="dsJustificativa"><?php echo $this->dsJustificativa; ?></textarea>
                                                    <label>
                                                        <?php
                                                        $auth = Zend_Auth::getInstance();
                                                        if (isset($auth->getIdentity()->usu_codigo)) {
                                                            echo 'Justificativa do Proponente';
                                                        } else {
                                                            echo 'Justificativa';
                                                        }
                                                        ?>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="input-field col s12">
                                                    <p>Ocorr&ecirc;ncia do T&eacute;cnico</p>
                                                    <p><?php echo $this->JustificativaTecnico; ?></p>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>

                                    <!-- Comprovação internacional-->
                                    <div id="bodyTabelaComprovanteInternacional">
                                        <fieldset>
                                            <legend>Dados da Comprova&ccedil;&atilde;o de Pagamento</legend>
                                            <div class="row">
                                                <div class="input-field col s6">
                                                    <input
                                                        type="text"
                                                        id="nomeRazaoSocialInternacional"
                                                        name="nomeRazaoSocialInternacional"
                                                        null="false"
                                                        <?php if ($this->exterior) : ?>
                                                            value="<?php echo $this->fornecedor[0]->dsEndereco; ?>"
                                                        <?php endif; ?>
                                                    />
                                                    <label for="nomeRazaoSocialInternacional">Nome da Empresa<span
                                                            style='color:red'>*</span></label>
                                                </div>
                                                <div class="input-field col s6">
                                                    <input
                                                        type="text"
                                                        id="enderecoInternacional"
                                                        name="enderecoInternacional"
                                                        <?php if ($this->exterior) : ?>
                                                            value="<?php echo $this->fornecedor[0]->dsPais; ?>"
                                                        <?php endif; ?>
                                                    />
                                                    <label for="enderecoInternacional"> Endere&ccedil;o</label>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="input-field col s6">
                                                    <input type="text" id="nif" name="nif" null="false"
                                                           value="<?php echo $this->nrComprovante; ?>"/>
                                                    <label> N&uacute;mero do documento<span
                                                            style='color:red'>*</span></label>
                                                </div>
                                                <div class="input-field col s6">
                                                    <p>
                                                        <label><b id="nmSerieTxt" colspan="3">Tipo de
                                                                Documento</b></label>
                                                    </p>
                                                    <p>
                                                        <input type="radio" name="nrSerieInternacional"
                                                               id="tipo_documento_invoice" value="6"
                                                            <?php
                                                            if (6 == $this->nrSerie || !$this->nrSerie) :
                                                                echo 'checked="checked"';
                                                            endif;
                                                            ?>
                                                        />
                                                        <label for="tipo_documento_invoice">Invoice </label>
                                                        <input type="radio" name="nrSerieInternacional"
                                                               id="tipo_documento_outros" value="7"
                                                            <?php
                                                            if (7 == $this->nrSerie) :
                                                                echo 'checked="checked"';
                                                            endif;
                                                            ?>
                                                        />
                                                        <label for="tipo_documento_outros">Outros</label>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="input-field col s6">
                                                    <input
                                                        type="text"
                                                        id="dtEmissaoInternacional"
                                                        name="dtEmissaoInternacional"
                                                        null="false"
                                                        data="true"
                                                        value="<?php echo $this->dtEmissao; ?>"
                                                    />
                                                    <label for="dtEmissaoInternacional">Dt. do Documento<span
                                                            style='color:red'>*</span></label>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="input-field col s4">
                                                    <input type="text" name="vlComprovadoInternacional" size="10"
                                                           id="vlComprovadoInternacional"
                                                           value="<?php echo $this->vlComprovacao; ?>"/>
                                                    <label for="vlComprovadoInternacional">Valor do Item <span
                                                            style='color:red'>*</span></label>
                                                </div>
                                                <div class="file-field input-field col s4">
                                                    <!-- input type="file" id="arquivoInternacional" name="arquivoInternacional" value=""/>
                                                    <label>Anexar comprovante<span style='color:red'>*</span></label-->
                                                    <div class="btn">
                                                        <span>Anexar comprovante</span>
                                                        <input id="arquivoInternacional" name="arquivoInternacional"
                                                               type="file">
                                                    </div>
                                                    <div class="file-path-wrapper">
                                                        <input class="file-path validate" type="text">
                                                    </div>
                                                </div>
                                                <div class="input-field col s4">
                                                    <a href="<?php echo $this->url(array('controller' => 'upload', 'action' => 'abrir'), '', true); ?>?id=<?php echo $this->idArquivo; ?>"><?php echo $this->nomeArquivo; ?></a>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="input-field col s12">
                                                    <textarea id="dsJustificativaInternacionalId"
                                                              class="materialize-textarea" rows="5"
                                                              name="dsJustificativaInternacional"><?php echo $this->dsJustificativa; ?></textarea>
                                                    <label for="dsJustificativaInternacionalId">Justificativa</label>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>

                                <table id="tableItensCusto" class="tabela linhaMaior1 sumir">
                                    <tr>
                                        <td class="">Contrato</td>
                                        <td class="">Produto</td>
                                        <td class="">Etapa</td>
                                        <td class="">Item</td>
                                        <td class="">Valor do Item</td>
                                        <td class="">Desvincular</td>
                                    </tr>
                                </table>

                                <div class="row">
                                    <div class="col s12 center-align">
                                        <?php if (!$this->vrSituacao || !$this->pagCompRecusado) : ?>
                                            <!--a href="<?php echo $voltarHref; ?>" id="btnVoltar" style="text-decoration:none;"><input type="button" class="btn_voltar" /></a-->
                                            <a class="btn" href="<?php echo $voltarHref; ?>" id="btnVoltar"><i
                                                    class="material-icons left">arrow_back</i>voltar</a>
                                        <?php endif; ?>
                                        <?php if ($this->idComprovantePagamento): ?>
                                            <!-- input type="submit" name="frComprovarPagamentoSubmit" id="frComprovarPagamentoSubmit" value="" class="btn_salvar" /-->
                                            <button type="submit" name="frComprovarPagamentoSubmit"
                                                    id="frComprovarPagamentoSubmit" value="" class="btn">salvar
                                            </button>
                                            <!-- input type="button" name="incluirNovo" id="incluirNovo" value="" class="btn_novo" /-->
                                            <button type="button" name="incluirNovo" id="incluirNovo" value=""
                                                    class="btn">novo
                                            </button>
                                        <?php else: ?>
                                            <!--input type="submit" name="frComprovarPagamentoSubmit" id="frComprovarPagamentoSubmit" value="" class="btn_incluir" /-->
                                            <button type="submit" name="frComprovarPagamentoSubmit"
                                                    id="frComprovarPagamentoSubmit" value="" class="btn">
                                                <i class="material-icons left ">add</i>incluir
                                            </button>
                                        <?php endif; ?>
                                    </div>
                                </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col s12">
                    <?php if (!$this->vrSituacao) : ?>
                        <table id="tabelaComprovantePagamento" class="bordered">
                            <thead>
                            <tr>
                                <th>Produto</th>
                                <th>Etapa</th>
                                <th>Item</th>
                                <th>CPF/CNPJ</th>
                                <th>N&uacute;mero</th>
                                <th>Tipo do Doc.</th>
                                <th>Data Emiss&atilde;o</th>
                                <th>Documento</th>
                                <th>Valor Comprovado</th>
                                <th>Editar</th>
                                <th>Excluir</th>
                            </tr>
                            </thead>
                            <tbody>
                            <?php if (empty($this->comprovantes)) : ?>
                                <tr>
                                    <td class="centro" colspan="10">Nenhuma comprova&ccedil;&atilde;o de pagamento
                                        cadastrada.
                                    </td>
                                </tr>
                            <?php else: ?>
                                <?php foreach ($this->comprovantes as $comprovante) : ?>
                                    <tr>
                                        <td><?php echo $comprovante->produtonome; ?></td>
                                        <td><?php echo $comprovante->etapanome; ?></td>
                                        <td><?php echo $comprovante->itemnome; ?></td>
                                        <td nowrap><?php echo $comprovante->fornecedor->CNPJCPF; ?></td>
                                        <td><?php echo $comprovante->nrComprovante; ?></td>
                                        <td>
                                            <?php if ($comprovante->idFornecedorExterior == '') : ?>
                                                <?php echo $comprovante->tipoDocumentoNome; ?>
                                            <?php else : ?>
                                                <?php echo ($comprovante->tpDocumento == 6) ? 'Invoice' : 'Outros'; ?>
                                            <?php endif; ?>
                                        </td>
                                        <td><?php echo $comprovante->dtEmissao; ?></td>
                                        <td>
                                            <a href=" <?php echo $this->url(array('controller' => 'upload', 'action' => 'abrir', 'id' => $comprovante->idArquivo,)); ?> ">
                                                <?php echo $comprovante->nmArquivo; ?>
                                            </a>
                                        </td>
                                        <td><?php echo $this->currency($comprovante->vlComprovacao); ?></td>
                                        <?php
                                        $comprovacaoTexto = array(
                                            1 => 'Comprova¿¿o validada',
                                            3 => 'Comprova¿¿o recusada',
                                        );
                                        ?>
                                        <?php if ($comprovante->stItemAvaliado == 4 || $comprovante->stItemAvaliado == 3): /* n¿o analisado ou recusado */ ?>
                                        <?php if ($comprovante->stItemAvaliado == 3): ?>
                                            <span
                                                class="bold"><?php echo $comprovacaoTexto[$comprovante->stItemAvaliado]; ?></span>
                                        <?php endif; ?>
                                        <td>
                                            <a
                                                class="small btn btn-primary"
                                                href="
                                                    <?php echo $this->url(
                                                    array(
                                                        'controller' => 'comprovarexecucaofinanceira',
                                                        'action' => 'comprovacaopagamento',
                                                        'idComprovantePagamento' => $comprovante->idComprovantePagamento,
                                                    )
                                                );
                                                ?>"
                                            >
                                                <i class="material-icons">edit</i>
                                            </a>
                                        </td>
                                        <td>
                                            <a
                                                class="small waves-effect waves-darken btn  btn-danger exclusao"
                                                href="
                                                    <?php echo $this->url(
                                                    array(
                                                        'controller' => 'comprovar-pagamento',
                                                        'action' => 'deletar',
                                                        'comprovante' => $comprovante->idComprovantePagamento,
                                                    )
                                                );
                                                ?>">
                                                <i class="material-icons">delete</i>
                                                <?php else: ?>
                                                    <span
                                                        class="bold"><?php echo $comprovacaoTexto[$comprovante->stItemAvaliado]; ?></span>
                                                <?php endif; ?>
                                        </td>
                                    </tr>
                                <?php endforeach; ?>
                            <?php endif; ?>
                            </tbody>
                        </table>
                    <?php endif; ?>
                </div>
            </div>
            <div id="desc_item"></div>
        </div>
    </div>
</div>
<iframe id="anexarArquivo" name="anexarArquivo" src="#" style="width: 300px;height: 300px;display: none;"></iframe>

<div id="alerta"></div>

<style type="text/css">
    label.error {
        display: block;
    }

    #bodyTabelaComprovante, #bodyTabelaComprovanteInternacional {
        display: none;
    }

    #bodyTabelaComprovante:target, #bodyTabelaComprovanteInternacional:target {
        display: table-row-group;
    }
</style>

<script type="text/javascript">
    $(document).ready(function () {
        // adiciona zeros a n&uacute;meros que n¿o tem todos os d¿gitos depois do zero (sen¿o quebra)
        $('#vlComprovado').val(parseFloat($('#vlComprovado').val()).toFixed(2));
        $('#vlComprovadoInternacional').val(parseFloat($('#vlComprovadoInternacional').val()).toFixed(2));

        // inicializa formata¿¿o de pre¿o
        $('#vlComprovado').priceFormat({limit: 8});
        $('#vlComprovadoInternacional').priceFormat({limit: 8});
    });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        // tratamento comum
        var form = '#incluircomprovacaoAjax';
        /* $('input[type!=button][type!=submit]').addClass('input_simples'); */
        /* $('textarea').addClass('textarea_simples'); */
        /* $('select[id!=perfilXgrupo]').addClass('select_simples'); */

        $(form).find('[data=true]').each(function () {
            $(this).keyup(function () {
                mascara(this, format_data);
                var este = this;
                setTimeout(function () {
                    $(este).val($(este).val().substr(0, 10));
                }, 2);
                if ($(este).val().length == 10) {
                    validaDataCorreta(este, $(este).val().substr(6, 4), $(este).val().substr(3, 2), $(este).val().substr(0, 2));
                }
            });
            $(this).datepicker({
                showOn: 'button',
                buttonImage: '<?php echo $this->baseUrl(); ?>/public/img/ico/calendar.gif',
                buttonImageOnly: true,
                dateFormat: 'dd/mm/yy',
                maxDate: '0'
            });
        });
        $(form).find('[sonumero=true]').keyup(function () {
            mascara(this, format_num);
        });
        $(form).find('[dinheiro=true]').keyup(function () {
            mascara(this, format_moeda);
        });

        $(form).find('[cnpjcpf=true]').each(function () {
            console.log('teste1:');
            var este = this;
            /* $('.' + $(este).attr('classaux')).click(function () { */
            $('.' + $(este).prop('classaux')).click(function () {
                mascaraCNPJCPF(este);
                buscarFornecedor(este);
            });
            /* $('#' + $(este).prop('idDescricao')).attr('readonly', true); */
            $('#' + $(este).prop('idDescricao')).prop('readonly', true);
        });

        $(form).find('[cnpjcpf=true]').keyup(function () {
            mascaraCNPJCPF(this);
            buscarFornecedor(this);
        });

        function mascaraCNPJCPF(este) {
            var marcado = buscarRadioMarcado(este);
            console.log('teste');
            switch (marcado) {
                case 'cpf':
                    $(este).val($(este).val().slice(0, 14));
                    $(este).attr('maxlength', 14);
                    mascara(este, format_cpf);
                    break;
                case 'cnpj':
                    $(este).attr('maxlength', 18);
                    mascara(este, format_cnpj);
                    break;
                default:
                    janelaAlerta('Selecione o Tipo do Fornecedor');
                    $(este).val('');
            }
        }

        function buscarRadioMarcado(este) {
            console.log('teste:');
            var marcado = '';
            $('.' + $(este).attr('classaux')).each(function () {
                /* if ($(this).attr('checked')) { */
                if ($(this).prop('checked')) {
                    marcado = $(this).val();
                }
            });
            return marcado;
        }

        function buscarFornecedor(este) {
            if ($(este).attr('idAgente') != undefined && $(este).attr('idAgente') && $(este).attr('idDescricao') != undefined && $(este).attr('idDescricao')) {
                var marcado = buscarRadioMarcado(este);
                if ((marcado == 'cpf' && $(este).val().length == 14) || (marcado == 'cnpj' && $(este).val().length == 18)) {
                    var fornecedor = buscarJson('<?php echo $buscarFornecedorHref;?>', {cnpjcpf: $(este).val()});
                    if (fornecedor.retorno) {
                        $('#' + $(este).attr('idAgente')).val(fornecedor.idAgente);
                        $('#' + $(este).attr('idDescricao')).val(fornecedor.descricao).attr('readonly', true);

                    } else {
                        $('html').css('overflow', 'hidden');
                        $("body").append("<div id='divDinamicaAgentes'></div>");
                        $("#divDinamicaAgentes").html("");
                        $('#divDinamicaAgentes').html("<br><br><center>Carregando dados...</center>");
                        $.ajax({
                            url: '<?php echo $this->url(array('module' => 'agente', 'controller' => 'agentes', 'action' => 'incluirfornecedor')); ?>',
                            data: {
                                cpf: fornecedor.CNPJCPF,
                                caminho: "",
                                modal: "s"
                            },
                            success: function (data) {
                                if (data.error) {
                                    $('#divDinamicaAgentes').html(data.msg);
                                } else {
                                    $('#divDinamicaAgentes').html(data);
                                }
                            },
                            complete: function () {
                                $("#resultadoFinalizar").html("");
                            },
                            type: 'post'

                        });

                        $("#divDinamicaAgentes").dialog({
                            resizable: true,
                            width: $(window).width() - 100,
                            height: $(window).height() - 100,
                            modal: true,
                            autoOpen: true,
                            draggable: false,
                            title: 'Cadastrar Fornecedor',
                            buttons: {
                                'Fechar': function () {
                                    $("#divDinamicaAgentes").remove();
                                    $('#' + $(este).attr('idAgente')).val('');
                                    $('#' + $(este).attr('idDescricao')).val('');
                                    $(this).dialog('close');
                                    $('html').css('overflow', 'auto');
                                    outroFornecedor(este);
                                }
                            }
                        });
                        $('.ui-dialog-titlebar-close').remove();
                    }
                }
                else {
                    $('#' + $(este).attr('idAgente')).val('');
                    $('#' + $(este).attr('idDescricao')).val('');
                }
            }
            fornecedores();
        }

        //Mensagem para Utilizar este fornecedor para Comprova¿¿o Financeira, sim ou n¿o.
        function outroFornecedor(este) {
            $("#divPerguntaFornecedor").dialog('close');
            $("#divPerguntaFornecedor").html('Deseja utilizar este fornecedor na comprova&ccedil;&atilde;o do pagamento?');
            $("#divPerguntaFornecedor").dialog('open');
            $("#divPerguntaFornecedor").dialog({
                resizable: false,
                width: 320,
                height: 180,
                modal: true,
                draggable: false,
                title: 'Alerta!',
                buttons: {
                    'N\xE2o': function () {
                        $('#' + $(este).attr('idAgente')).val('');
                        $('#' + $(este).attr('idDescricao')).val('');
                        $('#CNPJCPF').val('');
                        $("#divPerguntaFornecedor").dialog('close');
                    },
                    'Sim': function () {
                        $(this).dialog('close');
                        buscarFornecedor(este);
                    }
                }
            });
            $('.ui-dialog-titlebar-close').remove();
        }

        function fornecedores() {
            var conteudo = '<option value="">Selecione</option>';
            conteudo += montagem(1);
            conteudo += montagem(2);
            conteudo += montagem(3);
            $('#fornecedor').html(conteudo);
        }

        function montagem(nr) {
            var conteudo = '';
            if ($('#Descricao' + nr).val() != undefined) {
                if ($('#Descricao' + nr).val().replace(/\s+/g, '')) {
                    var idAgente = '';
                    if ($('#idAgente' + nr).val() == '')
                        idAgente = '-' + nr;
                    else
                        idAgente = $('#idAgente' + nr).val();
                    conteudo += '<option value="' + idAgente + '">' + $('#Descricao' + nr).val() + '</option>';
                    $('.fornecedor' + nr).each(function () {
                        $(this).val(idAgente);
                    });
                    $('.td_fornecedor' + nr).each(function () {
                        $(this).html($('#Descricao' + nr).val());
                    });
                }
            }
            return conteudo;
        }

        function buscarJson(pagina, dados) {
            var retorno = '';
            var select = requisicaoAjaxObj();
            select.executar({
                pagina: pagina,
                parametros: dados,
                resposta: undefined,
                async: false,
                funcaoRetorno: function (resposta) {
                    retorno = resposta;
                }
                , dataType: 'json'
            });
            return retorno;
        }

        function requisicaoAjaxObj() {
            var ajaxObj = {
                pagina: '',
                parametros: {},
                type: 'post',
                dataType: '',
                resposta: '#conteudo',
                async: true,
                funcaoRetorno: function (resposta) {
                    $(this.resposta).html(resposta);
                },
                executar: function (dados) {
                    this.refineParametrosObj(dados);
                    var esteObj = this;
                    if (this.resposta != undefined && this.resposta != '')
                        $(this.resposta).html('<img src="<?php echo $this->baseUrl(); ?>/public/img/ajax.gif" alt="carregando"><br/><br/>Carregando...<br>Por Favor, aguarde!!');
                    $.ajax({
                        type: esteObj.type,
                        url: esteObj.pagina,
                        data: esteObj.parametros,
                        async: esteObj.async,
                        success: function (resp) {
                            esteObj.funcaoRetorno(resp);
                        }
                        , dataType: esteObj.dataType
                    });
                },
                refineParametrosObj: function (data) {
                    if (data != undefined)
                        for (var j in data) {

                            this[j] = data[j];
                        }
                }
            };
            return ajaxObj;
        }

        // quando selecionar cheque, limita n&uacute;mero de caracteres do nrDocumentoDePagamento
        $('#tpFormaDePagamento').change(function () {
            if ($(this).val() == 1) {
                $('#nrDocumentoDePagamento').attr('maxlength', 6);
            } else {
                $('#nrDocumentoDePagamento').attr('maxlength', 10)
            }
        });

        $('#itens').change(function () {
            // Recupera o fornecedor e preenche os dados do mesmo.
            $.ajax({
                url: '<?php echo $this->baseUrl();?>/fornecedor/pesquisar-fornecedor-item/format/json',
                type: 'get',
                data: {'item': $(this).val()},
                dataType: 'json',
                success: function (result) {
                    if (undefined != result.fornecedor) {
                        if (11 == result.fornecedor.CNPJCPF.length) {
                            var mask = '999.999.999-99';
                        } else {
                            var mask = '99.999.999/9999-99';
                        }
                        $("#tabelaComprovante tbody:nth-child(1) tr:nth-child(2)").attr('style', 'display:none');
                        $("#idAgente").val(result.fornecedor.idAgente);
                        $("#CNPJCPF").val(result.fornecedor.CNPJCPF).mask(mask).attr('disabled', 'true');
                        $("#Descricao").val(result.fornecedor.Fornecedor).attr('disabled', 'true');
                    }
                }
            });
        });

        <?php if ($this->idComprovantePagamento): ?>
        $("#incluirNovo").click(function () {
            window.location = "<?php echo $this->url(array(
                'controller' => 'comprovarexecucaofinanceira',
                'action' => 'comprovacaopagamento',
                'idusuario' => $this->idusuario,
                'idpronac' => $this->idpronac,
                'idPlanilhaAprovacao' => $this->idPlanilhaAprovacao
            ), null, true); ?>";
        });
        <?php endif; ?>

        $("#frComprovarPagamentoSubmit").click(function () {
            var msg = ';'
            if (isInvoice()) {
                msg = validarParametrosDeComprovacaoDePagamentoInvoice();
            } else {
                msg = validarParametrosDeComprovacaoDePagamento();
            }

            if (isInvoice()) {
                valorComprovado = $('#vlComprovadoInternacional').val();
            } else {
                valorComprovado = $('#vlComprovado').val();
            }

            var valorItem = parseFloat(valorComprovado.replace(".", "").replace(".", "").replace(",", "."));
            var valorAprovado = parseFloat($("#valorAprovado").val());
            var valorComprovado = parseFloat($("#totalComprovado").val());

            if (
                (!$("#idComprovantePagamento").val() && (valorComprovado && (valorItem + valorComprovado).toFixed(2) > valorAprovado))
                ||
                ($("#idComprovantePagamento").val() && (valorComprovado && valorItem > valorAprovado))
            ) {
                msg += 'Valor comprovado maior que o valor aprovado.<br />';
            }
            if ('' != msg) {
                $("#msgAlerta").dialog("destroy");
                $("#msgAlerta").html('<center><p>' + msg + '</p></center>');
                $("#msgAlerta").dialog({
                    resizable: false,
                    title: 'Alerta!',
                    width: 500,
                    height: 300,
                    modal: true,
                    buttons: {
                        'OK': function () {
                            $(this).dialog('close');
                        }
                    }
                });
                $('.ui-dialog-titlebar-close').remove();
                return false;
            }
        });

        function validarParametrosDeComprovacaoDePagamento() {
            var msg = '';
            if (!$("#vlComprovado").val()) {
                msg += 'Informe o valor do item.<br />';
            }
            if (parseFloat($("#vlComprovado").val()) === 0) {
                msg += 'O valor do item n&atilde;o pode ser igual a zero.<br />';
            }
            if (!$("#idAgente").val()) {
                msg += 'Informe um fornecedor.<br />';
            }
            if (!$("#tpDocumento").val() || 0 == $("#tpDocumento").val()) {
                msg += 'Selecione o tipo de comprovante.<br />';
            }
            if (!$("#nrComprovante").val()) {
                msg += 'Informe o n&uacute;mero do comprovante.<br />';
            }
            if (!$("#dtEmissao").val()) {
                msg += 'Informe a data de emiss&atilde;o do comprovante.<br />';
            }
            if (!$("#tpFormaDePagamento").val() || 0 == $("#tpFormaDePagamento").val()) {
                msg += 'Selecione a forma de pagamento.<br />';
            }
            if (!$("#nrDocumentoDePagamento").val()) {
                msg += 'Informe o n&uacute;mero do Documento de pagamento.<br />';
            }

            if ($("#idComprovantePagamento").val()) {
                if (!$("#arquivo_edit").val()) {
                    msg += 'Selecione um arquivo comprovante para envio.<br />';
                }
            } else {
                if (!$("#arquivo").val()) {
                    msg += 'Selecione um arquivo comprovante para envio.<br />';
                }
            }
            return msg;
        }

        function validarParametrosDeComprovacaoDePagamentoInvoice() {
            var msg = '';
            if (!$("#vlComprovadoInternacional").val()) {
                msg += 'Informe o valor do item.<br />';
            }
            if (!$("#nomeRazaoSocialInternacional").val()) {
                msg += 'Informe o Nome/Raz&atilde;o Social.<br />';
            }
            if (!$("#nif").val()) {
                msg += 'Informe o NIF.<br />';
            }
            if (!$("#dtEmissaoInternacional").val()) {
                msg += 'Informe a data de emiss&atilde;o do comprovante.<br />';
            }
            if ($("#arquivoInternacional").val() == '') {
                if (!$("#arquivo_edit").val()) {
                    msg += 'Selecione um arquivo comprovante para envio.<br />';
                }
            } else {
                if (!$("#arquivoInternacional").val()) {
                    msg += 'Selecione um arquivo comprovante para envio.<br />';
                }
            }
            return msg;
        }

        $('#tabelaComprovantePagamento tbody tr td a.exclusao').closest('a').each(function () {
            $(this).unbind('click').click(function (event) {
                event.preventDefault();
                $("#alerta").dialog("destroy");
                $("#alerta").html('Deseja realmente excluir esse comprovante?');
                $("#alerta").dialog({
                    resizable: false,
                    title: 'Alerta!',
                    width: 340,
                    modal: true,
                    buttons: {
                        'OK': function () {
                            deletarItem($(event.target).parent());
                            $(this).dialog('close');
                        },
                        'Cancelar': function () {
                            $(this).dialog('close');
                        }
                    }
                });
                $('.ui-dialog-titlebar-close').remove();
            });
        });

        deletarItem = function (elementLink) {
            $.ajax({
                url: elementLink.attr('href') + '/format/json',
                dataType: 'json',
                success: function (result) {
                    // remove a linha
                    elementLink.closest('tr').remove();
                    // atualiza as informacoes do item
                    $("campoValorAprovado").html('000').toNumber().formatCurrency({region: 'pt-BR'});
                    $("#campoValorComprovado").html('000').toNumber().formatCurrency({region: 'pt-BR'});
                    // Recupera o item e preenche os valores aprovado e comprovado.
                    $.ajax({
                        url: '<?php echo $this->baseUrl();?>/planilha-item/pesquisar/format/json',
                        type: 'get',
                        data: {'item': planilhaItem},
                        dataType: 'json',
                        success: function (result) {
                            if (result.item) {
                                planilhaItem = result.item;
                                $("campoValorAprovado").html(result.item.valorAprovado).toNumber().formatCurrency({region: 'pt-BR'});
                                $("campoValorComprovado").html(result.item.valorComprovado).toNumber().formatCurrency({region: 'pt-BR'});
                            }
                            message('Exclus&atilde;o realizada com sucesso!', 'CONFIRM');
                        }
                    });
                }
            });
        };
    });

    function toggleTabelaComprovacaoPagamentoInvoice() {
        if (isInvoice()) {
            $('#bodyTabelaComprovante').hide();
            $('#bodyTabelaComprovanteInternacional').show();
        } else {
            $('#bodyTabelaComprovante').show();
            $('#bodyTabelaComprovanteInternacional').hide();
        }
    }

    function isInvoice() {
        return 'Brasil' !== $('#pais').val();
    }

    toggleTabelaComprovacaoPagamentoInvoice();
    if (!isInvoice()) {
        var cnpjcpf = document.getElementById('CNPJCPF');
        mascaraCNPJCPF(cnpjcpf);
    }

    /* $3('select').material_select(); */
</script>
<script>
  $(document).ready(function() {
    /* $3('select').material_select(); */
   console.log($3('#tpFornecedorCpf :checked').val());
  });
</script>
